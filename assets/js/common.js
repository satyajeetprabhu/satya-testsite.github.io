/**
 * Common JavaScript for Satyajeet Prabhu Website
 * Handles all shared elements across pages
 */

(function() {
    'use strict';
    
    // Configuration object for all shared elements
    const siteConfig = {
        // Analytics
        analytics: {
            gtag: 'UA-46876043-1'
        },
        
        // Preload resources
        preloads: [
            { href: 'assets/css/fonts.css', as: 'style' },
            { href: 'assets/images/backgrounds/25471753_processed.jpg', as: 'image', fetchpriority: 'high' }
        ],
        
        // Stylesheets
        stylesheets: [
            'assets/css/fonts.css',
            'assets/css/modern.css',
            'assets/css/social-icons.css',
            'assets/css/pages.css'
        ],
        
        // Header
        logo: 'SATYAJEET PRABHU',
        
        // Social links
        social: {
            linkedin: {
                url: 'https://www.linkedin.com/in/satyajeet-prabhu/',
                label: 'LinkedIn Profile'
            },
            email: {
                url: 'mailto:satyajeetprabhu@gmail.com',
                label: 'Send Email'
            }
        },
        
        // Footer
        copyright: 'Â© 2025 Satyajeet Prabhu. All rights reserved.',
        
        // Scripts
        scripts: [
            'assets/js/navigation.js',
            'assets/js/interactions.js'
        ]
    };
    
    // Generate head elements
    function generateHead() {
        const head = document.head;
        
        // Add favicon
        const favicon = document.createElement('link');
        favicon.rel = 'icon';
        favicon.type = 'image/x-icon';
        favicon.href = '/favicon.ico';
        head.appendChild(favicon);
        
        // Add Apple touch icon
        const appleIcon = document.createElement('link');
        appleIcon.rel = 'apple-touch-icon';
        appleIcon.href = '/apple-touch-icon.png';
        head.appendChild(appleIcon);
        
        // Add preload links
        siteConfig.preloads.forEach(preload => {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.href = preload.href;
            link.as = preload.as;
            head.appendChild(link);
        });
        
        // Add Google Analytics
        const gtagScript = document.createElement('script');
        gtagScript.async = true;
        gtagScript.src = `https://www.googletagmanager.com/gtag/js?id=${siteConfig.analytics.gtag}`;
        head.appendChild(gtagScript);
        
        const gtagConfig = document.createElement('script');
        gtagConfig.textContent = `
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', '${siteConfig.analytics.gtag}');
        `;
        head.appendChild(gtagConfig);
        
        // Add stylesheets
        siteConfig.stylesheets.forEach(stylesheet => {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = stylesheet;
            head.appendChild(link);
        });
    }
    
    // Generate skip navigation
    function generateSkipNav() {
        const body = document.body;
        
        const skipNav = document.createElement('a');
        skipNav.href = '#main-content';
        skipNav.className = 'skip-nav';
        skipNav.textContent = 'Skip to main content';
        
        // Insert at beginning of body
        body.insertBefore(skipNav, body.firstChild);
    }
    
    // Generate header
    function generateHeader() {
        const body = document.body;
        
        // Create header structure
        const header = document.createElement('header');
        header.className = 'hero';
        
        header.innerHTML = `
            <nav class="nav" role="navigation" aria-label="Main navigation">
                <div class="container">
                    <div class="nav-content">
                        <div class="logo">${siteConfig.logo}</div>
                        
                        <ul class="nav-menu" role="menubar">
                            <!-- Navigation will be generated by navigation.js -->
                        </ul>

                        <button class="hamburger" id="hamburger" aria-label="Open mobile menu" aria-expanded="false">
                            <span></span>
                            <span></span>
                            <span></span>
                        </button>
                    </div>
                </div>
            </nav>

            <div class="hero-content">
                <h1 class="hero-title" id="page-title">PAGE TITLE</h1>
            </div>
        `;
        
        // Insert at beginning of body
        body.insertBefore(header, body.firstChild);
    }
    
    // Generate mobile navigation
    function generateMobileNav() {
        const body = document.body;
        
        const mobileNav = document.createElement('nav');
        mobileNav.className = 'mobile-nav';
        mobileNav.id = 'mobile-nav';
        mobileNav.setAttribute('role', 'navigation');
        mobileNav.setAttribute('aria-label', 'Mobile navigation');
        
        mobileNav.innerHTML = `
            <button class="close-menu" id="close-menu" aria-label="Close mobile menu">&times;</button>
            <ul role="menu">
                <!-- Navigation will be generated by navigation.js -->
            </ul>
        `;
        
        const overlay = document.createElement('div');
        overlay.className = 'mobile-nav-overlay';
        overlay.id = 'mobile-nav-overlay';
        
        // Insert after header
        const header = document.querySelector('.hero');
        if (header) {
            header.parentNode.insertBefore(mobileNav, header.nextSibling);
            header.parentNode.insertBefore(overlay, mobileNav.nextSibling);
        }
    }
    
    // Generate social links
    function generateSocialLinks() {
        const body = document.body;
        
        const aside = document.createElement('aside');
        aside.className = 'social-links';
        aside.setAttribute('aria-label', 'Social media links');
        
        aside.innerHTML = `
            <span class="wsite-social wsite-social-default">
                <a class="wsite-social-item wsite-social-linkedin" href="${siteConfig.social.linkedin.url}" target="_blank" rel="noopener noreferrer" aria-label="${siteConfig.social.linkedin.label}">
                    <span class="wsite-social-item-inner"></span>
                </a>
                <a class="wsite-social-item wsite-social-mail" href="${siteConfig.social.email.url}" aria-label="${siteConfig.social.email.label}">
                    <span class="wsite-social-item-inner"></span>
                </a>
            </span>
        `;
        
        // Insert after mobile nav overlay
        const overlay = document.getElementById('mobile-nav-overlay');
        if (overlay) {
            overlay.parentNode.insertBefore(aside, overlay.nextSibling);
        }
    }
    
    // Generate footer
    function generateFooter() {
        const body = document.body;
        
        const footer = document.createElement('footer');
        footer.className = 'footer';
        footer.setAttribute('role', 'contentinfo');
        
        footer.innerHTML = `
            <div class="container">
                <p>${siteConfig.copyright}</p>
            </div>
        `;
        
        // Insert at end of body
        body.appendChild(footer);
    }
    
    // Generate scripts
    function generateScripts() {
        const body = document.body;
        
        // Load scripts and ensure navigation is populated
        const loadScript = (src) => {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                body.appendChild(script);
            });
        };
        
        // Load all scripts sequentially
        siteConfig.scripts.reduce((promise, scriptSrc) => {
            return promise.then(() => loadScript(scriptSrc));
        }, Promise.resolve()).then(() => {
            // Manually trigger navigation update since DOMContentLoaded might have already fired
            setTimeout(() => {
                if (window.generateNavigation) {
                    const currentPage = window.location.pathname.split('/').pop() || 'index.html';
                    
                    // Update desktop navigation
                    const desktopNav = document.querySelector('.nav-menu');
                    if (desktopNav) {
                        desktopNav.innerHTML = window.generateNavigation(currentPage);
                    }
                    
                    // Update mobile navigation
                    const mobileNav = document.querySelector('.mobile-nav ul');
                    if (mobileNav) {
                        mobileNav.innerHTML = window.generateNavigation(currentPage);
                        
                        // Re-attach event listeners to new mobile nav links
                        const newMobileNavLinks = mobileNav.querySelectorAll('a');
                        newMobileNavLinks.forEach(link => {
                            link.addEventListener('click', () => {
                                // Close mobile nav when clicking on menu items
                                const mobileNav = document.getElementById('mobile-nav');
                                const mobileNavOverlay = document.getElementById('mobile-nav-overlay');
                                const body = document.body;
                                
                                if (mobileNav) {
                                    mobileNav.classList.remove('active');
                                }
                                if (mobileNavOverlay) {
                                    mobileNavOverlay.classList.remove('active');
                                }
                                body.classList.remove('menu-open');
                                body.style.overflow = '';
                            });
                        });
                    }
                }
            }, 100); // Small delay to ensure everything is loaded
        });
    }
    
    // Set page title based on current page
    function setPageTitle() {
        const currentPage = window.location.pathname.split('/').pop() || 'index.html';
        const pageTitleMap = {
            'index.html': 'ABOUT',
            'work.html': 'WORK',
            'music.html': 'MUSIC',
            'tech.html': 'ACADEMIC & TECH'
        };
        
        const pageTitle = pageTitleMap[currentPage] || 'PAGE';
        const titleElement = document.getElementById('page-title');
        if (titleElement) {
            titleElement.textContent = pageTitle;
        }
    }
    
    // Initialize all common elements
    function initializeCommonElements() {
        generateHead();
        generateSkipNav();
        generateHeader();
        generateMobileNav();
        generateSocialLinks();
        generateFooter();
        generateScripts();
        setPageTitle();
    }
    
    // Run when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeCommonElements);
    } else {
        initializeCommonElements();
    }
    
})(); 